# Sharding / Data Partitioning (分片/数据分区)

## Partitioning Methods (分区方法)
- **Horizontal Partitioning (水平分区)**
  - **Range-Based Sharding (基于范围的分片)**
    - 将不同的行放入不同的表中。
  - **缺点**：
    - 如果选择用于分片的范围值不慎重，分区方案可能导致服务器负载不均衡。

- **Vertical Partitioning (垂直分区)**
  - 将特定功能的数据划分到自己的服务器上。
  - **优点**：
    - 实现简单。
    - 对应用影响小。
  - **缺点**：
    - 为支持应用的增长，数据库可能需要进一步分区。

- **Directory-Based Partitioning (基于目录的分区)**
  - 一个了解分区方案的查找服务，并将其从数据库访问代码中抽象出来。
  - 允许添加数据库服务器或更改分区方案而不影响应用。
  - **缺点**：
    - 可能成为单点故障。

## Partitioning Criteria (分区标准)
- **Key or Hash-Based Partitioning (基于键或哈希的分区)**
  - 对某个条目的键属性应用哈希函数以获得分区编号。
  - **问题**：
    - 添加新服务器可能需要更改哈希函数，这需要重新分配数据并导致服务停机。
    - **解决方法**: [一致性哈希](https://en.wikipedia.org/wiki/Consistent_hashing)。

- **List Partitioning (列表分区)**
  - 每个分区分配一个值列表。

- **Round-Robin Partitioning (轮询分区)**
  - 使用 `n` 个分区，第 `i` 个元组分配到分区 `i % n`。

- **Composite Partitioning (复合分区)**
  - 结合上述任何分区方案来制定新的分区方案。
  - 一致性哈希是哈希和列表分区的复合。
    - 键 -> 通过哈希函数减少键空间 -> 列表 -> 分区。

## Common Problems of Sharding (分片的常见问题)
大多数约束是由于跨多个表或同一表中多个行的操作将不再在同一服务器上运行。

- **Joins and Denormalization (连接和非规范化)**
  - 连接性能低效，因为数据必须从多个服务器编译。
  - **解决方法**：非规范化数据库，以便查询可以从单个表执行。但这可能导致数据不一致。

- **Referential Integrity (参照完整性)**
  - 难以执行数据完整性约束（例如外键）。
  - **解决方法**：
    - 应用代码强制执行参照完整性。
    - 应用程序可以运行SQL作业来清理悬空引用。

- **Rebalancing (再平衡)**
  - 再平衡的必要性：
    - 数据分布不均匀。
    - 某个分片负载过大。
  - 创建更多的数据库分片或重新平衡现有分片会更改分区方案并需要数据移动。